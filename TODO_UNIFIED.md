# قائمة مهام مشروع MediSwitch الموحدة

هذه قائمة المهام الموحدة لاستكمال تطوير تطبيق **MediSwitch** - المنصة الذكية الشاملة لإدارة الأدوية وتبديلها بذكاء. تم دمج المهام من ملفي TODO.md و TODO_ENHANCED.md مع تحديد المهام التي تم إلغاؤها والتي سيتم إعادة العمل عليها من جديد.

## تحديثات البنية التحتية

### 1. تحديث أدوات البناء
- [x] ترقية Gradle من الإصدار 7.6.3 إلى الإصدار 8.10
- [ ] تحديث تبعيات Flutter إلى أحدث إصدار متوافق
- [ ] تحسين زمن البناء وتقليل حجم التطبيق النهائي

## المهام ذات الأولوية القصوى

### 1. استكمال تشفير قاعدة البيانات باستخدام SQLCipher (AES-256)

- [x] إضافة مكتبة SQLCipher إلى المشروع
- [x] تنفيذ آلية توليد وتخزين مفتاح التشفير بشكل آمن (تم إنجازه جزئيًا)
- [ ] **إصلاح مشكلة تهيئة SQLCipher في ملف database_service.dart** (خطأ في الأقواس المتداخلة):
  - [ ] تصحيح طريقة فتح قاعدة البيانات المشفرة باستخدام المفتاح الآمن
  - [ ] إضافة استدعاء `initializeSqlCipherLibs()` بشكل صحيح
  - [ ] تنفيذ معالجة الأخطاء المناسبة عند فشل فتح قاعدة البيانات
- [ ] تحسين آلية تخزين مفتاح التشفير باستخدام flutter_secure_storage:
  - [ ] إضافة طبقة إضافية من التشفير للمفتاح نفسه
  - [ ] ربط المفتاح بمعرف الجهاز الفريد لمنع نقل قاعدة البيانات بين الأجهزة
  - [ ] تنفيذ آلية استعادة المفتاح في حالة فقدانه
- [ ] تنفيذ اختبارات أداء لقياس تأثير التشفير على سرعة الاستعلامات
- [ ] تنفيذ آلية للتحقق من سلامة قاعدة البيانات عند فتحها
- [ ] إضافة خيار في الإعدادات لتغيير كلمة المرور/المفتاح (اختياري للمستخدمين المتقدمين)

### 2. إصلاح أخطاء ملف dose_comparison_screen.dart

- [ ] إصلاح خطأ في السطر 120: طريقة `getMedicationById` غير معرفة في الكلاس `DatabaseService`
- [ ] إصلاح أخطاء بناء الجملة في الأسطر 577-587 (أخطاء في الأقواس المتداخلة والفواصل المنقوطة)
- [ ] إعادة هيكلة الكود لعرض المخطط البياني المقارن والجدول بشكل صحيح

### 3. تطوير نظام تحديث البيانات من ملفات Excel/CSV

- [x] تنفيذ نظام استيراد البيانات الأساسي من ملف CSV
- [ ] **تحسين خدمة excel_import_service.dart**:
  - [ ] إصلاح الأخطاء في معالجة قيم الخلايا من نوع CellValue
  - [ ] إضافة دعم لتنسيقات Excel المختلفة (.xlsx, .xls)
  - [ ] تنفيذ آلية التعرف التلقائي على أعمدة الملف حتى لو اختلف ترتيبها
  - [ ] إضافة دعم للترميز العربي (UTF-8) لضمان استيراد النصوص العربية بشكل صحيح
  - [ ] تنفيذ آلية للتعامل مع الخلايا الفارغة أو القيم غير الصالحة
- [ ] تطوير واجهة مستخدم لاستيراد البيانات:
  - [ ] إضافة شاشة لاختيار ملف Excel/CSV من الجهاز
  - [ ] عرض معاينة للبيانات قبل الاستيراد
  - [ ] إظهار تقدم عملية الاستيراد
  - [ ] عرض تقرير بنتائج الاستيراد (عدد السجلات المضافة/المحدثة/المرفوضة)
- [ ] تنفيذ آلية تحديث البيانات عن بُعد:
  - [ ] إنشاء خدمة سحابية بسيطة لاستضافة ملفات التحديث
  - [ ] تنفيذ آلية للتحقق من وجود تحديثات جديدة
  - [ ] تنزيل وتطبيق التحديثات تلقائيًا أو بناءً على طلب المستخدم
  - [ ] إضافة جدولة للتحقق من التحديثات (يوميًا/أسبوعيًا/شهريًا)
- [ ] تحسين أمان عملية التحديث:
  - [ ] التحقق من توقيع الملف للتأكد من مصدره
  - [ ] تشفير ملفات التحديث أثناء النقل
  - [ ] إنشاء نسخة احتياطية قبل تطبيق التحديث

### 4. تحسين نظام النسخ الاحتياطي واستعادة البيانات

- [x] تنفيذ آلية إنشاء نسخة احتياطية أساسية
- [ ] **تحسين خدمة backup_service.dart**:
  - [ ] إصلاح الأخطاء في ملف backup_restore_screen.dart المرتبطة بخدمة النسخ الاحتياطي
  - [ ] تشفير النسخ الاحتياطية باستخدام كلمة مرور المستخدم
  - [ ] ضغط النسخ الاحتياطية لتقليل حجمها
  - [ ] إضافة بيانات تعريفية للنسخة الاحتياطية (الإصدار، تاريخ الإنشاء، عدد السجلات)
  - [ ] تنفيذ آلية للتحقق من سلامة النسخة الاحتياطية قبل الاستعادة
- [ ] تطوير واجهة مستخدم للنسخ الاحتياطي والاستعادة:
  - [ ] إضافة شاشة لإدارة النسخ الاحتياطية
  - [ ] عرض قائمة بالنسخ الاحتياطية المتاحة مع تفاصيلها
  - [ ] إمكانية مشاركة النسخ الاحتياطية عبر البريد الإلكتروني أو التخزين السحابي
  - [ ] إمكانية جدولة النسخ الاحتياطي التلقائي (يوميًا/أسبوعيًا)
- [ ] دعم التخزين السحابي للنسخ الاحتياطية:
  - [ ] إضافة دعم لخدمات Google Drive و Dropbox
  - [ ] مزامنة النسخ الاحتياطية تلقائيًا مع الخدمات السحابية
  - [ ] استعادة البيانات من النسخ الاحتياطية السحابية

## مهام الواجهة الأمامية (Frontend)

### 1. تطوير واجهة المستخدم الأساسية
- [x] إنشاء الهيكل الأساسي للتطبيق
- [x] تنفيذ نظام التنقل بين الشاشات
- [x] تنفيذ دعم اللغتين العربية والإنجليزية
- [x] تنفيذ وضع الألوان الداكن (Dark Mode)
- [ ] تصميم وتنفيذ شعار التطبيق (حبة دواء زرقاء مع أيقونة مفتاح تبديل ذهبي)
- [ ] تحسين تجربة المستخدم (UX) وتصميم الواجهة (UI) بألوان هادئة (أزرق طبي + رمادي)
- [ ] تنفيذ خطوط عربية واضحة (Noto Sans Arabic) مع دعم RTL
- [ ] إضافة انتقالات سلسة (Animations) بين الشاشات
- [ ] تصميم تبويبات سفلية للتنقل السريع (الصفحة الرئيسية، حاسبة الجرعات، الإعدادات)
- [ ] تنفيذ تصميم متجاوب لجميع أحجام الشاشات (من iPhone SE إلى Samsung S24 Ultra)

### 2. شاشة البحث الذكي عن بدائل الأدوية
- [x] تنفيذ واجهة البحث الأساسية
- [x] تطوير نظام الاقتراحات التلقائية أثناء الكتابة باللغتين (تم إنجازه جزئياً)
- [ ] إضافة عرض الصور التوضيحية للأدوية في نتائج البحث
- [x] تنفيذ فلاتر تصفية النتائج (حسب السعر، الآثار الجانبية، التفاعلات الدوائية) (تم إنجازه جزئياً)
- [ ] إضافة خيار تصفية النتائج حسب "مصري/عالمي" أو "وصفة/غير وصفة"
- [ ] تحسين عرض نتائج البحث مع معلومات إضافية (التوفر، السعر، الشركة المصنعة)
- [ ] تنفيذ نظام تصحيح تلقائي للأخطاء الإملائية في البحث
- [ ] إضافة فلترة النتائج حسب الفئة العلاجية (مُصنَّفة تلقائيًّا من CSV)
- [ ] تنفيذ نظام Lazy Loading لعرض الأدوية عند التمرير
- [ ] تخزين صور الأدوية مؤقتًا باستخدام CachedNetworkImage

### 3. شاشة مقارنة الجرعات المكافئة
- [x] تصميم وتنفيذ واجهة مقارنة الجرعات
- [x] إنشاء نظام تحويل الجرعات بين الأدوية المشابهة
- [x] تنفيذ دعم الوحدات المختلفة (ملجم/ميكروجرام) والتحويل التلقائي بينها
- [x] تطوير رسوم بيانية توضح النسب المئوية للفعالية والسمية
- [x] إضافة إمكانية مشاركة نتائج المقارنة
- [ ] **إعادة تصميم وتنفيذ شاشة مقارنة الجرعات المكافئة** (بسبب الأخطاء الحالية):
  - [ ] إصلاح مشكلة عرض المخطط البياني المقارن
  - [ ] إصلاح مشكلة عرض جدول المقارنة
  - [ ] تحسين واجهة المقارنة لتكون أكثر جاذبية وسهولة في الاستخدام
- [ ] إضافة خاصية اقتراح بدائل مع نسبة تشابه دقيقة

### 4. شاشة حاسبة جرعة الدواء (حسب الوزن)
- [x] تصميم وتنفيذ واجهة حاسبة الجرعات
- [x] إنشاء نموذج إدخال وزن المريض (بالكجم أو الرطل) مع تحديد العمر
- [x] تنفيذ نظام حساب الجرعات المخصصة بناءً على الوزن والعمر
- [ ] **إعادة تصميم وتنفيذ شاشة حاسبة جرعة الدواء** (بسبب الأخطاء الحالية):
  - [ ] إصلاح مشكلة طريقة `getMedicationById` غير المعرفة
  - [ ] تحسين واجهة المستخدم وتجربة المستخدم
- [ ] إضافة تنبيهات فورية (صوتية + نص أحمر) عند تجاوز الحدود الآمنة للجرعات
- [ ] تطوير خاصية حفظ الحسابات ومشاركتها مع المريض أو الفريق الطبي

### 5. تحسينات عامة للواجهة
- [ ] تحسين تجربة التنقل بين الشاشات
- [ ] إضافة رسوم متحركة (animations) لتحسين تجربة المستخدم
- [ ] تنفيذ نظام الإشعارات داخل التطبيق
- [x] تحسين دعم اتجاه النص RTL للغة العربية
- [ ] إضافة دليل تفاعلي (فيديوهات قصيرة) لشرح كيفية استخدام التطبيق
- [ ] تحسين أداء التطبيق على الأجهزة ذات المواصفات المنخفضة
- [ ] منع لقطات الشاشة لصفحات الجرعات (خاصة Android)

### 6. نظام الإعلانات والاشتراكات
- [ ] تنفيذ نظام الإعلانات في الإصدار المجاني:
  - [ ] إعلانات Banner غير مزعجة في أسفل الشاشة
  - [ ] إعلانات Interstitial كل 10 استخدامات
- [ ] تطوير نظام الاشتراكات المدفوعة (Premium):
  - [ ] إزالة الإعلانات للمشتركين
  - [ ] ميزة حفظ سجل البحث للمشتركين
  - [ ] تنبيهات بتغيرات الأسعار للمشتركين
- [ ] تنفيذ نظام الدفع الإلكتروني (سعر $1.99/شهريًّا)
- [ ] ربط التطبيق بحساب Google AdMob لإدارة الإعلانات

## مهام الخلفية (Backend)

### 1. تطوير قاعدة البيانات
- [x] إنشاء هيكل قاعدة البيانات الأساسي
- [x] تنفيذ نظام استيراد البيانات من ملف CSV
- [x] توسيع نموذج الدواء (Medication) ليشمل معلومات إضافية (التفاعلات، الآثار الجانبية، الصور)
- [ ] إنشاء جداول إضافية للفئات والمواد الفعالة والشركات المصنعة
- [ ] **إعادة تنفيذ نظام تشفير البيانات الحساسة باستخدام SQLCipher (AES-256)**
- [ ] تحسين أداء الاستعلامات وإضافة فهارس (indexes) إضافية
- [ ] إضافة نظام مزامنة البيانات مع خدمة سحابية
- [ ] تنظيم الأدوية تلقائيًّا في فئات (مسكنات، مضادات حيوية، إلخ)
- [ ] تنفيذ نظام عرض تاريخ التحديث والسعر بجانب كل دواء

### 2. تطوير نظام تحديث البيانات من Excel/CSV
- [ ] **إعادة تصميم وتنفيذ نظام استيراد البيانات من ملفات Excel**:
  - [ ] تنفيذ آلية مسح كافة البيانات القديمة واستبدالها بالجديدة
  - [ ] معالجة الأخطاء تلقائيًا (مثل أعمدة ناقصة)
  - [ ] تحويل البيانات من Excel إلى SQLite
- [ ] تنفيذ نظام تحديث البيانات دون الحاجة لإعادة نشر التطبيق
- [ ] إضافة نظام التحقق من صحة البيانات المستوردة
- [ ] تطوير آلية للاحتفاظ بتاريخ التحديثات

### 3. تطوير خدمات البحث والمقارنة
- [x] تنفيذ خدمة البحث الأساسية
- [ ] **إعادة تصميم وتنفيذ خدمة getMedicationById**
- [ ] تطوير خوارزمية البحث الذكي (بالاسم التجاري أو المادة الفعالة)
- [ ] إنشاء نظام اقتراحات البحث الذكية
- [x] تنفيذ خدمة مقارنة الجرعات المكافئة
- [x] تطوير خوارزمية حساب الجرعات بناءً على الوزن والعمر
- [ ] إنشاء نظام تحليل التفاعلات الدوائية
- [ ] تطوير نظام التصحيح التلقائي للأخطاء الإملائية
- [ ] تحسين سرعة البحث (تحميل البيانات خلال <2 ثانية حتى على اتصال 2G)

### 4. تطوير نظام الإدارة (Admin Dashboard - ويب)
- [ ] تصميم وتنفيذ لوحة تحكم للمسؤولين (ويب):
  - [ ] واجهة رفع ملفات Excel وتحديث قاعدة البيانات
  - [ ] عرض إحصائيات التطبيق (عدد المستخدمين النشطين، عمليات البحث الشائعة)
  - [ ] إدارة الإعلانات والاشتراكات
- [ ] ربط لوحة التحكم بالتطبيق عبر Firebase (خطة مجانية)
- [ ] تنفيذ نظام إدارة المستخدمين والصلاحيات
- [ ] إضافة نظام تحليلات لمتابعة استخدام التطبيق وتحسين تجربة المستخدم

### 5. تحسينات أمان وأداء
- [ ] **إعادة تنفيذ نظام تشفير البيانات المخزنة محليًا باستخدام SQLCipher**
- [ ] تحسين أداء قاعدة البيانات للاستعلامات المعقدة
- [ ] **إعادة تصميم وتنفيذ نظام النسخ الاحتياطي واستعادة البيانات**
- [ ] إضافة تسجيل الأحداث (logging) لتتبع الأخطاء وتحسين الأداء
- [ ] تنفيذ آلية للتحديثات التلقائية للتطبيق
- [ ] منع لقطات الشاشة للمعلومات الحساسة
- [ ] تحسين أداء التطبيق للعمل بدون اتصال دائم بالإنترنت

## أفكار جديدة لتطوير التطبيق

### 1. نظام تنبيهات ذكي لتغيرات الأسعار
- [ ] تنفيذ آلية لتتبع تغيرات أسعار الأدوية:
  - [ ] مقارنة الأسعار الجديدة مع القديمة عند تحديث البيانات
  - [ ] تخزين تاريخ تغير السعر ونسبة التغيير
  - [ ] عرض رسم بياني لتغيرات السعر على مدار الوقت
- [ ] إضافة نظام تنبيهات للمستخدمين:
  - [ ] تنبيه المستخدم عند تغير سعر دواء في قائمة المفضلة
  - [ ] إمكانية تعيين حد أقصى للسعر لتلقي تنبيه عند انخفاض السعر عنه
  - [ ] تنبيهات بالأدوية البديلة الأرخص عند ارتفاع سعر دواء معين

### 2. تحسين أداء البحث باستخدام تقنيات الفهرسة المتقدمة
- [ ] تنفيذ فهرسة نصية متقدمة:
  - [ ] استخدام تقنيات Full-Text Search لتحسين سرعة البحث
  - [ ] دعم البحث بالكلمات المفتاحية المتعددة
  - [ ] دعم البحث بالعبارات الدقيقة والبحث الضبابي
- [ ] تحسين خوارزمية البحث الذكي:
  - [ ] دعم تصحيح الأخطاء الإملائية تلقائيًا
  - [ ] دعم البحث بالمرادفات والمصطلحات الطبية المختلفة
  - [ ] ترتيب النتائج حسب الأهمية والملاءمة

### 3. إضافة ميزات تحليلية للأطباء والصيادلة
- [ ] تنفيذ نظام تحليل التفاعلات الدوائية المتقدم:
  - [ ] تحليل التفاعلات بين أكثر من دواءين في نفس الوقت
  - [ ] تصنيف التفاعلات حسب الخطورة والتأثير
  - [ ] تقديم توصيات لتجنب التفاعلات الخطيرة
- [ ] إضافة أداة تحليل الوصفات الطبية:
  - [ ] إمكانية إدخال قائمة أدوية المريض
  - [ ] تحليل التفاعلات والتداخلات بين الأدوية
  - [ ] اقتراح بدائل أكثر أمانًا أو فعالية

## خطة العمل لإصلاح الأخطاء وإعادة تصميم الأدوات

### المرحلة الأولى: إصلاح الأخطاء الحرجة
1. إصلاح مشكلة تهيئة SQLCipher في ملف database_service.dart
2. إصلاح الأخطاء في ملف dose_comparison_screen.dart
3. إضافة طريقة getMedicationById إلى DatabaseService
4. إصلاح الأخطاء في ملف backup_restore_screen.dart

### المرحلة الثانية: إعادة تصميم الأدوات الأساسية
1. إعادة تصميم وتنفيذ نظام تشفير البيانات باستخدام SQLCipher
2. إعادة تصميم وتنفيذ نظام النسخ الاحتياطي واستعادة البيانات
3. إعادة تصميم وتنفيذ نظام استيراد البيانات من ملفات Excel/CSV

### المرحلة الثالثة: تحسين واجهات المستخدم
1. إعادة تصميم وتنفيذ شاشة مقارنة الجرعات المكافئة
2. إعادة تصميم وتنفيذ شاشة حاسبة جرعة الدواء
3. تحسين واجهة البحث وعرض النتائج

### المرحلة الرابعة: إضافة الميزات الجديدة
1. تنفيذ نظام تنبيهات تغيرات الأسعار
2. تحسين أداء البحث باستخدام تقنيات الفهرسة المتقدمة
3. إضافة ميزات تحليلية للأطباء والصيادلة

## ملاحظات هامة
- يجب اختبار كل أداة بشكل منفصل قبل دمجها في التطبيق
- يجب إنشاء اختبارات وحدة (Unit Tests) لكل وظيفة جديدة
- يجب التأكد من توافق التطبيق مع أنظمة التشغيل المستهدفة (Android 8.0+ و iOS 13+)
- يجب الالتزام بمعايير أمان البيانات وخصوصية المستخدمين
- يجب إجراء اختبارات أداء دورية للتأكد من سرعة استجابة التطبيق